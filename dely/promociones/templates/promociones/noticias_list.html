{% extends 'base.html' %}
{% load static %}

{% block title %}Noticias{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'promociones/css/noticias_promo.css' %}">

<div class="container py-5" style="padding-top: 120px;">
  <!-- Header -->
  <div class="mb-5">
    <div class="row align-items-center g-4">
      <div class="col-lg-8">
        <h1 class="display-5 fw-bold text-danger mb-2">
          <i class="fas fa-newspaper me-2"></i>Noticias de Restaurantes
        </h1>
        <p class="lead text-muted">Mantente al día con las últimas novedades del mundo gastronómico</p>
      </div>
      <div class="col-lg-4">
        <div class="bg-white rounded-3 p-4 shadow-sm border border-danger border-opacity-25 text-center">
          <small class="text-muted d-block">Noticias Publicadas</small>
          <h3 class="fw-bold text-danger mb-0">{{ total_noticias }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Noticias Destacadas -->
  {% if noticias_destacadas %}
  <div class="mb-5">
    <h2 class="fw-bold text-dark mb-4">
      <i class="fas fa-star me-2 text-warning"></i>Destacadas
    </h2>
    <div class="row g-4">
      {% for noticia in noticias_destacadas %}
      <div class="col-md-6 col-lg-4">
        <div class="card shadow-sm border-0 h-100 overflow-hidden" style="border-radius: 16px;">
          {% if noticia.imagen_destacada %}
          <img src="{{ noticia.imagen_destacada }}" class="card-img-top" style="height: 180px; object-fit: cover;" alt="{{ noticia.titulo }}">
          {% else %}
          <div class="bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
            <i class="fas fa-newspaper text-muted" style="font-size: 3rem;"></i>
          </div>
          {% endif %}
          <div class="card-body d-flex flex-column">
            <h5 class="card-title fw-bold mb-2">{{ noticia.titulo|truncatewords:5 }}</h5>
            <p class="card-text text-muted small mb-3">{{ noticia.resumen }}</p>
            <small class="text-muted mb-3">{{ noticia.fecha_publicacion|date:"d M Y" }}</small>
            <a href="{% url 'noticia_detail' noticia.pk %}" class="btn btn-danger btn-sm mt-auto">
              <i class="fas fa-arrow-right me-1"></i>Leer más
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Filtros y Búsqueda -->
  <div class="bg-light rounded-3 p-4 mb-5 shadow-sm" style="border: 1px solid #e0e0e0;">
    <form method="GET" class="row g-3 align-items-end">
      <div class="col-md-3">
        <label class="form-label fw-bold text-dark">Tipo de Noticia</label>
        <select name="tipo" class="form-select" style="border-radius: 8px;">
          <option value="">Todos los tipos</option>
          {% for key, value in tipos_noticia %}
            <option value="{{ key }}" {% if key == tipo_seleccionado %}selected{% endif %}>{{ value }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label fw-bold text-dark">Restaurante</label>
        <input type="text" name="restaurante" class="form-control" 
               placeholder="Buscar por restaurante" value="{{ restaurante_busqueda }}"
               style="border-radius: 8px;">
      </div>
      <div class="col-md-4">
        <label class="form-label fw-bold text-dark">Buscar en contenido</label>
        <input type="text" name="q" class="form-control" 
               placeholder="Buscar noticias..." value="{{ busqueda }}"
               style="border-radius: 8px;">
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-danger w-100 fw-bold" style="border-radius: 8px; padding: 10px;">
          <i class="fas fa-search me-1"></i>Buscar
        </button>
      </div>
    </form>
  </div>

  <!-- Lista de Noticias -->
  <div class="row g-4">
    {% for noticia in noticias %}
    <div class="col-md-6 col-lg-4">
      <article class="card shadow-sm border-0 h-100 overflow-hidden" style="border-radius: 16px; transition: transform 0.2s, box-shadow 0.2s;">
        {% if noticia.imagen_destacada %}
        <img src="{{ noticia.imagen_destacada }}" 
             class="card-img-top" style="height: 180px; object-fit: cover;"
             alt="{{ noticia.titulo }}"
             onerror="this.src='https://via.placeholder.com/400x180/dc3545/ffffff?text=Noticia';">
        {% else %}
        <div class="bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
          <i class="fas fa-newspaper text-muted" style="font-size: 3rem;"></i>
        </div>
        {% endif %}
        
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <span class="badge bg-danger">{{ noticia.get_tipo_noticia_display }}</span>
            <small class="text-muted">{{ noticia.fecha_publicacion|date:"d M Y" }}</small>
          </div>
          
          {% if noticia.restaurante %}
          <div class="mb-2">
            <small class="text-danger fw-bold">
              <i class="fas fa-store me-1"></i>{{ noticia.restaurante.business_name }}
            </small>
          </div>
          {% endif %}
          
          <h5 class="card-title fw-bold mb-2">{{ noticia.titulo }}</h5>
          <p class="card-text text-muted small mb-3">{{ noticia.resumen }}</p>
          
          <div class="d-flex justify-content-between align-items-center mt-auto pt-3 border-top">
            <small class="text-muted">
              <i class="fas fa-eye me-1"></i>{{ noticia.vistas }}
              <i class="fas fa-heart ms-2 me-1"></i>{{ noticia.me_gusta }}
            </small>
            <a href="{% url 'noticia_detail' noticia.pk %}" class="btn btn-outline-danger btn-sm fw-bold">
              Leer <i class="fas fa-arrow-right ms-1"></i>
            </a>
          </div>
        </div>
      </article>
    </div>
    {% empty %}
    <div class="col-12 text-center py-5">
      <i class="fas fa-newspaper text-muted mb-3" style="font-size: 3rem; display: block;"></i>
      <h4 class="text-muted">No hay noticias disponibles</h4>
      <p class="text-muted">
        {% if busqueda or tipo_seleccionado or restaurante_busqueda %}
          Intenta ajustar tus filtros de búsqueda
        {% else %}
          Pronto tendremos nuevas noticias para ti
        {% endif %}
      </p>
    </div>
    {% endfor %}
  </div>

  <!-- Paginación -->
  {% if noticias.has_other_pages %}
  <nav aria-label="Paginación de noticias" class="mt-5">
    <ul class="pagination justify-content-center">
      {% if noticias.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page=1{% if request.GET.tipo %}&tipo={{ request.GET.tipo }}{% endif %}{% if request.GET.restaurante %}&restaurante={{ request.GET.restaurante }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Primera</a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ noticias.previous_page_number }}{% if request.GET.tipo %}&tipo={{ request.GET.tipo }}{% endif %}{% if request.GET.restaurante %}&restaurante={{ request.GET.restaurante }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Anterior</a>
        </li>
      {% endif %}

      <li class="page-item active">
        <span class="page-link">
          Página {{ noticias.number }} de {{ noticias.paginator.num_pages }}
        </span>
      </li>

      {% if noticias.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ noticias.next_page_number }}{% if request.GET.tipo %}&tipo={{ request.GET.tipo }}{% endif %}{% if request.GET.restaurante %}&restaurante={{ request.GET.restaurante }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Siguiente</a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ noticias.paginator.num_pages }}{% if request.GET.tipo %}&tipo={{ request.GET.tipo }}{% endif %}{% if request.GET.restaurante %}&restaurante={{ request.GET.restaurante }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Última</a>
        </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>

<style>
  .card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 24px rgba(220, 53, 69, 0.15) !important;
  }
</style>

{% endblock %}